!function(e){var t={};function i(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(s,n,function(t){return e[t]}.bind(null,n));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t){window.GoodiesUploader=class{constructor(e,t){this.$el=document.querySelector(e),this.$file="",this.$fileList=[],this.$options=t,this._cache={},this.listIndex=0,this.init()}init(){const e=`\n            <div id="drapUpWrap" class="goodies-upload__wrap">\n                <div class="goodies-upload__container">\n                    <div id="drapInputWrap">\n                        <input id="drapInputFile" type="file" class="goodies-upload__input" />\n                    </div>\n                    <div class="goodies-upload__dragger">\n                        <i class="iconfont icon-upload"></i>\n                        <div class="text">将文件拖到此处，或<em>点击上传</em></div>\n                    </div>\n                </div>\n                <div class="goodies-upload__tip" style="display: ${this.$options.note?"block":"none"};">${this.$options.note}</div>\n                <ul class="goodies-upload-list" id="drapUpList" style="display: none;"></ul>\n            </div>`;this.$el.innerHTML=e;const t=document.getElementById("drapUpWrap"),i=document.getElementById("drapInputFile"),s=document.querySelector(".goodies-upload__container");t.addEventListener("dragover",e=>{e.preventDefault(),s.setAttribute("class","goodies-upload__container is-dragover")}),t.addEventListener("dragleave",e=>{e.preventDefault(),s.setAttribute("class","goodies-upload__container")}),t.addEventListener("drop",e=>{e.preventDefault(),s.setAttribute("class","goodies-upload__container"),this.onChangeFile(e.dataTransfer.files[0],this.listIndex)}),i.addEventListener("change",e=>{this.onChangeFile(e.target.files[0],this.listIndex)})}onChangeFile(e,t){if(this.$file=e,!1===this.trigger("beforeUpload",e)._cache.beforeUpload[0]())return!1;const i=document.getElementById("drapUpList"),s=document.getElementById("drapInputWrap");i.setAttribute("style","display: block;"),i.innerHTML=i.innerHTML+`\n            <li id="listIndex${t}" class="goodies-upload-list__item has-progressbar" title="${this.$file.name}">\n                <div class="goodies-uploadlist__item-name">\n                    <i class="iconfont icon-document"></i>${this.$file.name}\n                </div>\n                <div class="goodies-upload-list__item-status-label">\n                    <i class="iconfont icon-checked"></i>\n                    <i class="iconfont icon-close"></i>\n                </div>\n                <div class="goodies-upload-progress-bar">\n                    <div class="goodies-upload-progress-bar__outer">\n                        <div class="goodies-upload-progress-bar__inner" style="width: 0%;"></div>\n                    </div>\n                    <div class="goodies-upload--progress__text">0%</div>\n                </div>\n            </li>\n            `,this.$fileList.push(e),this.listIndex++;let n=new FormData;const o=this.$options;if(n.append(o.name||"file",e),o.data&&"object"==typeof o.data)for(let e in o.data)n.append(e,o.data[e]);let r=new XMLHttpRequest;r.open("POST",o.action,!0);const l=document.querySelectorAll(".goodies-upload-list__item");if(l.length>0)for(let e of l)e.querySelector(".icon-close").addEventListener("click",t=>{i.removeChild(e),s.innerHTML="";let n=[];if(this.$fileList.length>0)for(let t of this.$fileList)t.name!=e.getAttribute("title")&&n.push(t);this.$fileList=n,r&&r.abort(),setTimeout(()=>{s.innerHTML='<input id="drapInputFile" type="file" class="goodies-upload__input" />',document.getElementById("drapInputFile").addEventListener("change",e=>{this.onChangeFile(e.target.files[0],this.listIndex)})},500)});r.onreadystatechange=()=>{if(r&&4===r.readyState&&(0!==r.status||r.responseURL&&0===r.responseURL.indexOf("file:"))){var t=r.response?JSON.parse(r.response):"";this.trigger("success",{responseData:t,file:e,fileList:this.$fileList}),r=null}},r.onerror=()=>{this.trigger("error",{file:e,fileList:this.$fileList}),r=null},r.upload&&r.upload.addEventListener("progress",e=>{const i=document.getElementById("listIndex"+t);var s=Math.round(100*e.loaded/e.total);const n=i.querySelector(".goodies-upload-progress-bar .goodies-upload-progress-bar__outer .goodies-upload-progress-bar__inner"),o=i.querySelector(".goodies-upload-progress-bar .goodies-upload--progress__text");n.setAttribute("style",`width: ${s}%`),o.innerHTML=s+"%",100===s&&i.setAttribute("class","goodies-upload-list__item")}),r.send(n)}on(e,t){let i=this._cache[e]=this._cache[e]||[];return-1===i.indexOf(t)&&i.push(t),this}trigger(e,t){let i=this._cache[e];return Array.isArray(i)&&i.forEach(e=>e(t)),this}off(e,t){let i=this._cache[e];if(Array.isArray(i))if(t){let e=i.indexOf(t);-1!==e&&i.splice(e,1)}else i.length=0;return this}}}]);