!function(e){var t={};function i(s){if(t[s])return t[s].exports;var o=t[s]={i:s,l:!1,exports:{}};return e[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)i.d(s,o,function(t){return e[t]}.bind(null,o));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t){window.GoodiesUploader=class{constructor(e,t){this.$el=document.querySelector(e),this.$fileList=[],this.$options=t,this._cache={},this.listIndex=0,this.init()}init(){const e=`\n            <div id="drapUpWrap" class="goodies-upload__wrap">\n                <div class="goodies-upload__container">\n                    <div id="drapInputWrap">\n                        <input id="drapInputFile" type="file" class="goodies-upload__input" style="display: ${this.$options.disabled?"none":"block"};"/>\n                    </div>\n                    <div class="goodies-upload__dragger">\n                        <i class="iconfont icon-upload"></i>\n                        <div class="text">将文件拖到此处，或<em>点击上传</em></div>\n                    </div>\n                </div>\n                <div class="goodies-upload__tip" style="display: ${this.$options.tip?"block":"none"};">${this.$options.tip}</div>\n                <ul class="goodies-upload-list" id="drapUpList" style="display: none;"></ul>\n            </div>`;this.$el.innerHTML=e;const t=document.getElementById("drapUpWrap"),i=document.getElementById("drapInputFile"),s=document.querySelector(".goodies-upload__container");this.$options.multiple&&i.setAttribute("multiple","multiple"),t.addEventListener("dragover",e=>{e.preventDefault(),this.$options.disabled||s.setAttribute("class","goodies-upload__container is-dragover")}),t.addEventListener("dragleave",e=>{e.preventDefault(),this.$options.disabled||s.setAttribute("class","goodies-upload__container")}),t.addEventListener("drop",e=>{if(e.preventDefault(),this.$options.disabled);else{s.setAttribute("class","goodies-upload__container");const t=e.dataTransfer.files;if(this.$options.multiple&&t.length>1)for(let e of t)this.onChangeFile(e,this.listIndex);else this.onChangeFile(t[0],this.listIndex)}}),i.addEventListener("change",e=>{const t=e.target.files;if(this.$options.multiple&&t.length>1)for(let e of t)this.onChangeFile(e,this.listIndex);else this.onChangeFile(t[0],this.listIndex)})}onChangeFile(e,t){let i=!1;if(!1===this.trigger("beforeUpload",e)&&(i=!0),i)return console.warn("Upload is paused."),!1;const s=document.getElementById("drapUpList"),o=document.getElementById("drapInputWrap");s.setAttribute("style","display: block;"),s.innerHTML=s.innerHTML+`\n            <li id="listIndex${t}" class="goodies-upload-list__item has-progressbar" title="${e.name}">\n                <div class="goodies-uploadlist__item-name">\n                    <i class="iconfont icon-document"></i>${e.name}\n                </div>\n                <div class="goodies-upload-list__item-status-label">\n                    <i class="iconfont icon-checked"></i>\n                    <i class="iconfont icon-close"></i>\n                </div>\n                <div class="goodies-upload-progress-bar">\n                    <div class="goodies-upload-progress-bar__outer">\n                        <div class="goodies-upload-progress-bar__inner" style="width: 0%;"></div>\n                    </div>\n                    <div class="goodies-upload--progress__text">0%</div>\n                </div>\n            </li>\n            `,this.$fileList.push(e),this.listIndex++;let n=new FormData;const l=this.$options;if(n.append(l.name||"file",e),l.data&&"object"==typeof l.data)for(let e in l.data)n.append(e,l.data[e]);let r=new XMLHttpRequest;if(r.open("POST",l.action,!0),l.headers)for(let e in l.headers)r.setRequestHeader(e,l.headers[e]);const d=document.querySelectorAll(".goodies-upload-list__item");if(d.length>0)for(let e of d)e.querySelector(".icon-close").addEventListener("click",t=>{s.removeChild(e),o.innerHTML="";let i=[];if(this.$fileList.length>0)for(let t of this.$fileList)t.name!=e.getAttribute("title")&&i.push(t);this.$fileList=i,r&&r.abort(),setTimeout(()=>{o.innerHTML='<input id="drapInputFile" type="file" class="goodies-upload__input" />',document.getElementById("drapInputFile").addEventListener("change",e=>{const t=e.target.files;if(this.$options.multiple&&t.length>1)for(let e of t)this.onChangeFile(e,this.listIndex);else this.onChangeFile(t[0],this.listIndex)})},500)});r.onreadystatechange=()=>{if(r&&4===r.readyState&&(0!==r.status||r.responseURL&&0===r.responseURL.indexOf("file:"))){var t=r.response?JSON.parse(r.response):"";this.trigger("success",{responseData:t,file:e,fileList:this.$fileList}),r=null}},r.onerror=()=>{this.trigger("error",{file:e,fileList:this.$fileList}),r=null},r.upload&&r.upload.addEventListener("progress",e=>{const i=document.getElementById("listIndex"+t);var s=Math.round(100*e.loaded/e.total);const o=i.querySelector(".goodies-upload-progress-bar .goodies-upload-progress-bar__outer .goodies-upload-progress-bar__inner"),n=i.querySelector(".goodies-upload-progress-bar .goodies-upload--progress__text");o.setAttribute("style",`width: ${s}%`),n.innerHTML=s+"%",100===s&&i.setAttribute("class","goodies-upload-list__item")}),r.send(n)}on(e,t){let i=this._cache[e]=this._cache[e]||[];return-1===i.indexOf(t)&&i.push(t),this}trigger(e,t){let i=this._cache[e]||[],s="";return Array.isArray(i)&&i.forEach(i=>{"beforeUpload"===e?s=i(t):i(t)}),"beforeUpload"===e?s:this}off(e,t){let i=this._cache[e];if(Array.isArray(i))if(t){let e=i.indexOf(t);-1!==e&&i.splice(e,1)}else i.length=0;return this}}}]);